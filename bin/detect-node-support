#!/usr/bin/env node

'use strict';

const Minimist = require('minimist');
const Util = require('util');

const NodeSupport = require('..');

const internals = {};

internals.help = () => {

    return `
Usage: detect-node-support [--deps] [--json] <what>

  <what> can be an npm package name, or a Github URL, or a path 
  with a package.json.

Options:
  --deps    Include the support information of all dependencies
  --json    Print JSON formatted output
`;
};

exports.main = async ({ _: [what], deps, json }) => {

    if (!what) {
        console.log(internals.help());
        return;
    }

    const result = await NodeSupport.detect(what, { deps });

    if (json) {
        console.log(JSON.stringify(result, null, '  '));
    }
    else {
        console.log(Util.inspect(result, false, null, true));
    }
};

exports.main(Minimist(process.argv.slice(2), { boolean: ['deps', 'json'] }))
    .catch((err) => {

        console.error(err);
        console.log(internals.help());
        process.exit(1);
    });
